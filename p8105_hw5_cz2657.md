HW5
================

``` r
library(tidyverse)
library(p8105.datasets)
library(patchwork)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1

``` r
homicide_df = 
  read_csv("data/homicide-data.csv", na = c("", "Unknown")) %>% 
  mutate(city_state = str_c(city, state), resolution = case_when(
    disposition == "Closed without arrest" ~ "unsolved", 
    disposition == "Open/No arrest" ~ "unsolved", 
    disposition == "Closed by arrest" ~ "solved")) %>% 
  relocate(city_state) %>% 
  filter(city_state != "TulsaAL")
```

    ## Rows: 52179 Columns: 12

    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (8): uid, victim_last, victim_first, victim_race, victim_sex, city, stat...
    ## dbl (4): reported_date, victim_age, lat, lon

    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Focusing on Baltimore, MD:

``` r
baltimiore_df = 
  homicide_df %>% 
  filter(city_state == "BaltimoreMD")

baltimore_summary = 
  baltimiore_df %>% 
  summarize(unsolved = sum(resolution == "unsolved"), 
            n = n())

baltimore_test = 
  prop.test(
    x = baltimore_summary %>% pull(unsolved), 
    n = baltimore_summary %>% pull(n))

baltimore_test %>% 
  broom::tidy()
```

    ## # A tibble: 1 × 8
    ##   estimate statistic  p.value parameter conf.low conf.high method    alternative
    ##      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr>     <chr>      
    ## 1    0.646      239. 6.46e-54         1    0.628     0.663 1-sample… two.sided

Let’s get those estimates across all cities

``` r
prop_test_function = function(city_df) {
  
  city_summary = 
  city_df %>% 
  summarize(unsolved = sum(resolution == "unsolved"), 
            n = n())

  city_test = 
    prop.test(
      x = city_summary %>% pull(unsolved), 
      n = city_summary %>% pull(n))

  return(city_test)
  
}

prop_test_function(baltimiore_df)
```

    ## 
    ##  1-sample proportions test with continuity correction
    ## 
    ## data:  city_summary %>% pull(unsolved) out of city_summary %>% pull(n), null probability 0.5
    ## X-squared = 239.01, df = 1, p-value < 2.2e-16
    ## alternative hypothesis: true p is not equal to 0.5
    ## 95 percent confidence interval:
    ##  0.6275625 0.6631599
    ## sample estimates:
    ##         p 
    ## 0.6455607

``` r
homicide_df %>% 
  filter(city_state == "AlbuquerqueNM") %>% 
  prop_test_function()
```

    ## 
    ##  1-sample proportions test with continuity correction
    ## 
    ## data:  city_summary %>% pull(unsolved) out of city_summary %>% pull(n), null probability 0.5
    ## X-squared = 19.114, df = 1, p-value = 1.232e-05
    ## alternative hypothesis: true p is not equal to 0.5
    ## 95 percent confidence interval:
    ##  0.3372604 0.4375766
    ## sample estimates:
    ##         p 
    ## 0.3862434

``` r
results_df = 
  homicide_df %>% 
  nest(data = uid:resolution) %>% 
  mutate(
    test_results = map(data, prop_test_function), 
    tidy_results = map(test_results, broom::tidy)
  ) %>% 
  select(city_state, tidy_results) %>% 
  unnest(tidy_results) %>% 
  select(city_state, estimate, starts_with("conf"))
```

Plot estimates and confidence intervals

``` r
results_df %>% 
  mutate(city_state = fct_reorder(city_state, estimate)) %>% 
  ggplot(aes(x = city_state, y = estimate)) + 
  geom_point() + 
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

<img src="p8105_hw5_cz2657_files/figure-gfm/unnamed-chunk-6-1.png" width="90%" />

Other approach:

``` r
homicide_df %>% 
  group_by(city_state) %>% 
  summarize(
    unsolved = sum(resolution == "unsolved"), 
    n = n()
  ) %>% 
  mutate(
    test_results = map2(unsolved, n, prop.test), 
    tidy_results = map(test_results, broom::tidy)
  ) %>% 
  select(city_state, tidy_results) %>% 
  unnest(tidy_results) %>% 
  select(city_state, estimate, starts_with("conf"))
```

    ## # A tibble: 50 × 4
    ##    city_state    estimate conf.low conf.high
    ##    <chr>            <dbl>    <dbl>     <dbl>
    ##  1 AlbuquerqueNM    0.386    0.337     0.438
    ##  2 AtlantaGA        0.383    0.353     0.415
    ##  3 BaltimoreMD      0.646    0.628     0.663
    ##  4 Baton RougeLA    0.462    0.414     0.511
    ##  5 BirminghamAL     0.434    0.399     0.469
    ##  6 BostonMA         0.505    0.465     0.545
    ##  7 BuffaloNY        0.612    0.569     0.654
    ##  8 CharlotteNC      0.300    0.266     0.336
    ##  9 ChicagoIL        0.736    0.724     0.747
    ## 10 CincinnatiOH     0.445    0.408     0.483
    ## # … with 40 more rows

## Problem 2

``` r
importcsv = function(filename) {
  
  x = str_c("data/data/", filename)
  data = read_csv(x)
  
  return(data)
}

importcsv("con_01.csv")
```

    ## # A tibble: 1 × 8
    ##   week_1 week_2 week_3 week_4 week_5 week_6 week_7 week_8
    ##    <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>
    ## 1    0.2  -1.31   0.66   1.96   0.23   1.09   0.05   1.94

``` r
prob2_df = 
  tibble(
  name = list.files("data/data/"), 
  data = purrr::map(name, importcsv))

full_data_2 = 
  prob2_df %>% 
    separate(name, c("treatment_arm", "id")) %>% 
  mutate(id = as.numeric(id), 
         treatment_arm = as.factor(treatment_arm)) %>% 
    unnest(data) %>% 
  pivot_longer(
    week_1:week_8, 
    names_to = "week", 
    names_prefix = "week_"
  ) %>% 
  mutate(id = ifelse(treatment_arm == "exp", id, id+10))

full_data_2 %>% 
  ggplot(aes(x = week, y = value, group = id, color = treatment_arm)) +
  geom_line() +
  labs(x = "Week", y = "Value") + 
  scale_color_discrete(name = "Trial Arm", labels = c("Control", "Experimental"))
```

<img src="p8105_hw5_cz2657_files/figure-gfm/unnamed-chunk-8-1.png" width="90%" />

Based on the spaghetti pot, it appears that those in the experimental
arm tend to have higher values than those in the control arm by the end
of week 8; however, values appeared much closer together at the
beginning of the trial period (meaning week 1). If the goal of the
treatment was to increase the values, it appears that the treatment was
effective.

## Problem 3

``` r
library(tidyverse)

set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```

Write a function

``` r
fill_in_missing = function(vector) {
  
  if (is.numeric) {
    
    
  }
  
  if(is.character) {
    
    
  }
  
  
}
```

if neither of those things, then spit out a warning message;

then if you have this written, I would check that it fills in the way
that it needs to

Where the mapping piece comes in, I would start at the first column and
map across each of the columns and update each of the columns within the
dataframe and then put it back together as a dataframe
